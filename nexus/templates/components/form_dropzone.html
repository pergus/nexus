{# Reusable file dropzone component for Dropzone.js #}
{# Usage: {% include 'components/form_dropzone.html' with name="files" label="Upload Files" multiple=True %} #}

<div class="mb-3{% if group_class %} {{ group_class }}{% endif %}">
  {% if label %}
    <label class="form-label{% if label_class %} {{ label_class }}{% endif %}">
      {{ label }}
      {% if required %}<span class="text-danger">*</span>{% endif %}
    </label>
  {% endif %}

  <div
    id="{{ id|default:name }}-dropzone"
    class="dropzone{% if dropzone_class %} {{ dropzone_class }}{% endif %}"
  >
    <div class="fallback">
      <input
        name="{{ name }}{% if multiple %}[]{% endif %}"
        type="file"
        {% if multiple %}multiple{% endif %}
        {% if accept %}accept="{{ accept }}"{% endif %}
        {% if required %}required{% endif %}
      >
    </div>
    <div class="dz-message needsclick">
      <i class="h1 bx bx-cloud-upload"></i>
      <h3>{{ dropzone_title|default:"Drop files here or click to upload." }}</h3>
      <span class="text-muted fs-13">
        {{ dropzone_description|default:"(Selected files are not actually uploaded.)" }}
      </span>
    </div>
  </div>

  {% if preview %}
    <ul class="list-unstyled mb-0" id="{{ id|default:name }}-preview">
      <li class="mt-2" id="{{ id|default:name }}-preview-list">
        <!-- This is used as the file preview template -->
        <div class="border rounded">
          <div class="d-flex align-items-center p-2">
            <div class="flex-shrink-0 me-3">
              <div class="avatar-sm bg-light rounded">
                <img data-dz-thumbnail class="img-fluid rounded d-block" src="#" alt="" />
              </div>
            </div>
            <div class="flex-grow-1">
              <div class="pt-1">
                <h5 class="fs-14 mb-1" data-dz-name>&nbsp;</h5>
                <p class="fs-13 text-muted mb-0" data-dz-size></p>
                <strong class="error text-danger" data-dz-errormessage></strong>
              </div>
            </div>
            <div class="flex-shrink-0 ms-3">
              <button data-dz-remove class="btn btn-sm btn-danger">Delete</button>
            </div>
          </div>
        </div>
      </li>
    </ul>
  {% endif %}

  {% if help_text %}
    <div class="form-text">{{ help_text }}</div>
  {% endif %}
</div>

{# Script to initialize the dropzone - should be placed in the template where this component is used #}
{# Example initialization script:
<script>
  var myDropzone = new Dropzone("#{{ id|default:name }}-dropzone", {
    url: "{{ upload_url|default:'/upload' }}",
    autoProcessQueue: {{ auto_process|yesno:"true,false"|default:"false" }},
    uploadMultiple: {{ multiple|yesno:"true,false"|default:"false" }},
    parallelUploads: {{ parallel_uploads|default:2 }},
    maxFilesize: {{ max_filesize|default:2 }}, // MB
    acceptedFiles: "{{ accept|default:"*" }}",
    addRemoveLinks: {{ add_remove_links|yesno:"true,false"|default:"true" }},
    dictRemoveFile: "{{ remove_file_text|default:'Remove file' }}",
    dictCancelUpload: "{{ cancel_upload_text|default:'Cancel upload' }}",
    {% if max_files %}maxFiles: {{ max_files }},{% endif %}
    {% if thumbnail_width %}thumbnailWidth: {{ thumbnail_width }},{% endif %}
    {% if thumbnail_height %}thumbnailHeight: {{ thumbnail_height }},{% endif %}

    init: function() {
      this.on("success", function(file, response) {
        // Handle successful upload
        console.log("File uploaded successfully");
      });

      this.on("error", function(file, errorMessage) {
        // Handle upload error
        console.log("File upload error: " + errorMessage);
      });
    }
  });
</script>
#}